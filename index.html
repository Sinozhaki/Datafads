<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Sewa LinkedIn - Fitur Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2a6fdb; --primary-hover: #2159b0; --text-dark: #1a2c4e;
            --text-light: #667; --bg-light: #f5f7fa;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --white: #ffffff; --border-color: #e9ecef;
            --green: #28a745; --red: #dc3545; --orange: #fd7e14;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { background: var(--bg-gradient); color: #333; min-height: 100vh; -webkit-font-smoothing: antialiased; }
        .main-container { max-width: 1200px; margin: 0 auto; padding: 20px; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; }
        header { text-align: center; padding: 20px 0; margin-bottom: 20px; }
        h1 { font-size: 2.5rem; color: var(--text-dark); margin-bottom: 10px; font-weight: 600; letter-spacing: -1px; }
        .subtitle { font-size: 1.1rem; color: var(--text-light); margin-bottom: 25px; }
        .status-indicator { display: flex; justify-content: center; align-items: center; gap: 25px; }
        .indicator { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #555; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .green-dot { background: var(--green); box-shadow: 0 0 10px rgba(40, 167, 69, 0.5); }
        .red-dot { background: var(--red); box-shadow: 0 0 10px rgba(220, 53, 69, 0.5); animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .data-card { background: var(--white); border-radius: 12px; padding: 20px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08); display: flex; flex-direction: column; }
        .card-header { font-weight: 500; color: var(--text-dark); word-break: break-all; margin-bottom: 15px; }
        .card-body { display: flex; justify-content: space-between; align-items: center; gap: 15px; margin-bottom: 20px; }
        .card-date { font-size: 1.1rem; font-weight: 600; color: var(--primary-color); }
        .card-footer { margin-top: auto; border-top: 1px solid var(--border-color); padding-top: 15px;}
        
        .status-light { width: 15px; height: 15px; border-radius: 50%; }
        .status-green { background-color: var(--green); animation: pulse-green 2s infinite; }
        .status-red { background-color: var(--red); animation: pulse-red 2s infinite; }
        @keyframes pulse-green { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); } }
        @keyframes pulse-red { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); } }

        .withdraw-btn, .withdraw-btn-locked { width: 100%; text-align: center; padding: 10px; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-block; transition: background-color 0.3s, color 0.3s, transform 0.3s; }
        .withdraw-btn { background-color: var(--green); color: white; }
        .withdraw-btn:hover { background-color: #218838; transform: translateY(-2px); }
        .withdraw-btn-locked { background-color: #f8f9fa; color: #6c757d; border: 1px solid #dee2e6; cursor: not-allowed; }

        .status { padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; display: inline-block; text-align: center; }
        .running-new { background-color: #e0f2f1; color: #00796b; } .running-old { background-color: #e3f2fd; color: #1976d2; }
        .unrestric { background-color: #fff8e1; color: #fbc02d; } .restric { background-color: #ffebee; color: #c62828; }
        .admin-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: linear-gradient(135deg, #4dabf7, var(--primary-color)); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 20px rgba(42, 111, 219, 0.4); transition: transform 0.3s ease, box-shadow 0.3s ease; z-index: 100; }
        .admin-btn:hover { transform: scale(1.1) rotate(15deg); box-shadow: 0 6px 25px rgba(42, 111, 219, 0.6); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: var(--white); border-radius: 10px; padding: 30px; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .modal-title { font-size: 1.5rem; color: var(--text-dark); }
        button, .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .btn-primary { background: var(--primary-color); color: white; } .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); }
        .btn-secondary { background: #e9ecef; color: #495057; border: 1px solid #ced4da; } .btn-secondary:hover { background: #dee2e6; }
        .btn-danger { background: #dc3545; color: white; } .btn-danger:hover { background: #c82333; }
        .btn-warning { background: var(--orange); color: white; } .btn-warning:hover { background: #e86a00; }
        .btn-group { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .action-buttons { display: flex; gap: 8px; } .action-btn { padding: 8px 10px; border-radius: 6px; font-size: 0.85rem; line-height: 1; border: 1px solid transparent; }
        .edit-btn { background-color: #e3f2fd; color: #1976d2; border-color: #bbdefb;} .delete-btn { background-color: #ffebee; color: #c62828; border-color: #ffcdd2;}
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 8px; background: var(--white); color: #333; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); transform: translateX(120%); transition: transform 0.4s ease-in-out; z-index: 2001; display: flex; align-items: center; gap: 10px; }
        .notification.show { transform: translateX(0); } .notification::before { content: ''; position: absolute; left: 0; top: 0; width: 5px; height: 100%; border-radius: 8px 0 0 8px; }
        .notification.success::before { background-color: var(--green); } .notification.error::before { background-color: var(--red); }
        .confirmation-text, #password-error { margin-bottom: 25px; font-size: 1.1rem; color: #555; }
        #password-error { color: #c62828; font-size: 0.9rem; margin-top: -15px; margin-bottom: 15px; display: none; }
        .loading { display: inline-block; width: 24px; height: 24px; border: 3px solid rgba(0, 0, 0, 0.1); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .admin-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-light); z-index: 1001; display: none; flex-direction: column; opacity: 0; transform: scale(0.95); transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background-color: var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .admin-title { font-size: 1.8rem; color: var(--text-dark); }
        .admin-header .btn-group { margin-top: 0;}
        .admin-content { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .form-container { background: var(--white); border-radius: 12px; padding: 25px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08); margin-bottom: 30px; }
        .form-container h3 { color: var(--text-dark); margin-bottom: 20px; font-size: 1.3rem; }
        #admin-data-form { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1fr auto; gap: 15px; align-items: flex-end; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; color: #495057; font-weight: 500; font-size: 0.9rem;}
        input, select, textarea { width: 100%; padding: 12px 15px; background: #f1f3f5; border: 1px solid #ced4da; border-radius: 8px; color: #333; font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(42, 111, 219, 0.2); }
        #cancel-edit-btn { display: none; }
        .filter-controls { display: flex; gap: 15px; margin-bottom: 20px; background: var(--white); padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .search-box { position: relative; flex-grow: 1; }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #adb5bd; }
        .search-input { width: 100%; padding-left: 40px; }
        #filter-status { flex-grow: 1; }
        .admin-card { display: flex; flex-direction: column; gap: 10px; margin-bottom: 0; }
        .admin-card .card-header, .admin-card .card-body { margin-bottom: 0; }
        .admin-card .card-footer { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .admin-card .card-info { display: flex; flex-direction: column; gap: 5px; font-size: 0.9rem; color: var(--text-light); }
        .admin-card .card-info span { font-weight: 600; color: var(--text-dark); }
        #email-list-input { height: 150px; resize: vertical; margin-bottom: 15px; }
        #identification-results { margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px; display: none;}
        #found-emails-list { max-height: 150px; overflow-y: auto; background-color: #f8f9fa; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; margin: 10px 0; }
        #found-emails-list div { padding: 5px; }
        .bulk-update-section { display: flex; gap: 10px; align-items: center; margin-top: 15px;}
        .bulk-update-section select { flex-grow: 1;}
        #deleted-items-list { max-height: 300px; overflow-y: auto; margin-top: 15px; }
        .deleted-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--border-color); }
        .deleted-item:last-child { border-bottom: none; }
        .deleted-item-info { display: flex; flex-direction: column; gap: 2px; }
        .deleted-item-info small { color: #6c757d; }
        .undo-btn:disabled { background-color: #6c757d; cursor: not-allowed; }

        @media (max-width: 992px) { #admin-data-form { grid-template-columns: 1fr 1fr; } #admin-data-form .btn-group { grid-column: 1 / -1; } }
        @media (max-width: 768px) { .admin-header, .filter-controls { flex-direction: column; gap: 15px; padding: 15px; } .admin-header .btn-group { flex-direction: column; width: 100%;} .main-container, .admin-content { padding: 15px; } #admin-data-form { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="main-container" id="main-container">
        <header>
            <h1>Data Sewa Akun LinkedIn</h1>
            <p class="subtitle">Layanan profesional penyewaan akun LinkedIn dengan akun terverifikasi.</p>
            <div class="status-indicator">
                <div class="indicator"><div class="dot green-dot"></div><span>Aman (Safe)</span></div>
                <div class="indicator"><div class="dot red-dot"></div><span>Restricted</span></div>
            </div>
        </header>
        <div class="filter-controls">
            <div class="search-box"><i class="fas fa-search"></i><input type="search" id="main-search-input" class="search-input" placeholder="Cari berdasarkan email..."></div>
            <select id="filter-status" class="form-control"><option value="all">Semua Status</option><option value="running new">Running New</option><option value="running old">Running Old</option><option value="unrestric">Unrestric</option><option value="restric">Restric</option></select>
        </div>
        <div id="data-card-container" class="card-container">
             <div style="text-align: center; grid-column: 1 / -1; padding: 40px;"><div class="loading"></div></div>
        </div>
    </div>
    <div class="admin-btn" id="admin-icon"><i class="fas fa-lock"></i></div>
    <div class="admin-page" id="admin-page">
        <header class="admin-header">
            <h2 class="admin-title">Panel Admin</h2>
            <div class="btn-group">
                <button id="history-btn" class="btn btn-secondary"><i class="fas fa-history"></i> Riwayat Hapus</button>
                <button id="identification-btn" class="btn btn-secondary"><i class="fas fa-search-plus"></i> Identifikasi</button>
                <button id="exit-admin-btn" class="btn btn-secondary"><i class="fas fa-sign-out-alt"></i> Keluar</button>
            </div>
        </header>
        <div class="admin-content">
            <div class="form-container">
                <h3 id="form-title">Tambah Data Baru</h3>
                <form id="admin-data-form">
                    <input type="hidden" id="edit-id">
                    <div class="form-group"><label for="email">Email</label><input type="email" id="email" required></div>
                    <div class="form-group"><label for="whatsapp">No. WhatsApp</label><input type="tel" id="whatsapp" placeholder="cth: 081234567890"></div>
                    <div class="form-group"><label for="date">Tanggal</label><input type="date" id="date" required></div>
                    <div class="form-group"><label for="status">Status</label><select id="status" required><option value="running new">Running New</option><option value="running old">Running Old</option><option value="unrestric">Unrestric</option><option value="restric">Restric</option></select></div>
                    <div class="btn-group"><button type="submit" id="save-btn" class="btn-primary"><i class="fas fa-save"></i> Simpan</button><button type="button" id="cancel-edit-btn" class="btn-secondary"><i class="fas fa-times"></i> Batal</button></div>
                </form>
            </div>
            <div class="filter-controls">
                 <div class="search-box"><i class="fas fa-search"></i><input type="search" id="admin-search-input" class="search-input" placeholder="Cari email di mode admin..."></div>
            </div>
            <div id="admin-card-container" class="card-container"></div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="confirmation-modal-1">
        <div class="modal-content"><div class="modal-header"><h2 class="modal-title">Konfirmasi</h2></div><p class="confirmation-text">Anda yakin ingin menghapus item ini?</p><div class="btn-group"><button class="btn-secondary" data-action="close">Batal</button><button class="btn-warning" data-action="confirm-1">Lanjutkan</button></div></div>
    </div>
     <div class="modal" id="confirmation-modal-2">
        <div class="modal-content"><div class="modal-header"><h2 class="modal-title">Konfirmasi Final</h2></div><p class="confirmation-text">Tindakan ini tidak dapat diurungkan langsung dan akan masuk ke riwayat. Hapus secara permanen?</p><div class="btn-group"><button class="btn-secondary" data-action="close">Batal</button><button class="btn-danger" data-action="confirm-2">Ya, Hapus</button></div></div>
    </div>
    <div class="modal" id="password-modal">
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">Login Admin</h2></div>
            <form id="password-form">
                <div class="form-group"><label for="password">Kata Sandi</label><input type="password" id="password" required></div>
                <p id="password-error">Kata sandi salah. Coba lagi.</p>
                <div class="btn-group"><button type="button" class="btn-secondary" id="cancel-password">Batal</button><button type="submit" class="btn-primary">Masuk</button></div>
            </form>
        </div>
    </div>
    <div class="modal" id="identification-modal">
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">Identifikasi Email</h2> <button class="btn-close-modal" data-modal-id="identification-modal">&times;</button></div>
            <div class="form-group"><label for="email-list-input">Paste daftar email di sini (satu email per baris):</label><textarea id="email-list-input" placeholder="email1@contoh.com\nemail2@contoh.com"></textarea><button id="process-emails-btn" class="btn btn-primary" style="width: 100%;">Proses</button></div>
            <div id="identification-results"><h3 id="found-count">Ditemukan 0 email</h3><div id="found-emails-list"></div><div class="bulk-update-section"><select id="bulk-status-select"><option value="running new">Running New</option><option value="running old">Running Old</option><option value="unrestric">Unrestric</option><option value="restric">Restric</option></select><button id="bulk-update-btn" class="btn btn-primary">Ubah Status</button></div></div>
        </div>
    </div>
    <div class="modal" id="history-modal">
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">Riwayat Hapus</h2><button class="btn-close-modal" data-modal-id="history-modal">&times;</button></div>
            <div id="deleted-items-list"></div>
        </div>
    </div>
    
    <div class="notification" id="notification"><span id="notification-text"></span></div>
    <script>
        const BIN_ID = "68b3e227d0ea881f406cae4f";
        const API_KEY = "$2a$10$gu4kR9LLESmdKRQXfOJHVO2yV.JqLT5MekhEHoG4x8krtS7dktwdC";
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        let dataEmails = [];
        let deletedItems = [];
        let pendingDeleteId = null;
        let identifiedEmailsForUpdate = [];
        
        const mainContainer = document.getElementById('main-container'), adminPage = document.getElementById('admin-page'),
              adminIcon = document.getElementById('admin-icon'), cardContainer = document.getElementById('data-card-container'),
              adminCardContainer = document.getElementById('admin-card-container'),
              confirmationModal1 = document.getElementById('confirmation-modal-1'),
              confirmationModal2 = document.getElementById('confirmation-modal-2'),
              passwordModal = document.getElementById('password-modal'), passwordError = document.getElementById('password-error'),
              adminForm = document.getElementById('admin-data-form'), mainSearchInput = document.getElementById('main-search-input'),
              filterStatus = document.getElementById('filter-status'), adminSearchInput = document.getElementById('admin-search-input'),
              identificationModal = document.getElementById('identification-modal'),
              historyModal = document.getElementById('history-modal');
        
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            adminIcon.addEventListener('click', () => { passwordModal.style.display = 'flex'; document.getElementById('password').focus(); });
            document.getElementById('password-form').addEventListener('submit', handleLogin);
            document.getElementById('cancel-password').addEventListener('click', () => passwordModal.style.display = 'none');
            document.getElementById('exit-admin-btn').addEventListener('click', exitAdminMode);
            adminForm.addEventListener('submit', saveData);
            document.getElementById('cancel-edit-btn').addEventListener('click', clearAdminForm);
            
            confirmationModal1.addEventListener('click', handleConfirmation1);
            confirmationModal2.addEventListener('click', handleConfirmation2);

            mainSearchInput.addEventListener('input', () => renderMainView());
            filterStatus.addEventListener('change', () => renderMainView());
            adminSearchInput.addEventListener('input', () => renderAdminView());

            document.getElementById('identification-btn').addEventListener('click', openIdentificationModal);
            document.getElementById('process-emails-btn').addEventListener('click', processEmailList);
            document.getElementById('bulk-update-btn').addEventListener('click', bulkUpdateStatus);
            document.getElementById('history-btn').addEventListener('click', openHistoryModal);

            document.querySelectorAll('.btn-close-modal').forEach(btn => {
                btn.addEventListener('click', () => document.getElementById(btn.dataset.modalId).style.display = 'none');
            });
            
            cardContainer.addEventListener('click', (e) => {
                if (e.target.matches('.withdraw-btn-locked')) {
                    showNotification('Penarikan hanya bisa dilakukan pada hari Rabu - Jumat.', 'error');
                }
            });

            adminCardContainer.addEventListener('click', (e) => {
                const target = e.target.closest('.action-btn'); if (!target) return;
                const id = parseInt(target.dataset.id);
                if (target.classList.contains('edit-btn')) { populateEditForm(id); } 
                else if (target.classList.contains('delete-btn')) { startDeleteProcess(id); }
            });

            document.getElementById('deleted-items-list').addEventListener('click', (e) => {
                const target = e.target.closest('.undo-btn');
                if (target && !target.disabled) {
                    undoDelete(parseInt(target.dataset.id));
                }
            });
        }

        function handleLogin(e) { e.preventDefault(); const pw = document.getElementById('password'); if (pw.value === '123') { passwordModal.style.display = 'none'; pw.value = ''; passwordError.style.display = 'none'; enterAdminMode(); } else { passwordError.style.display = 'block'; } }
        function enterAdminMode() { mainContainer.style.opacity = '0'; mainContainer.style.transform = 'scale(0.95)'; adminIcon.style.display = 'none'; setTimeout(() => { mainContainer.style.display = 'none'; adminPage.style.display = 'flex'; renderAdminView(); setTimeout(() => { adminPage.style.opacity = '1'; adminPage.style.transform = 'scale(1)'; }, 50); }, 300); }
        function exitAdminMode() { adminPage.style.opacity = '0'; adminPage.style.transform = 'scale(0.95)'; setTimeout(() => { adminPage.style.display = 'none'; mainContainer.style.display = 'block'; adminIcon.style.display = 'flex'; setTimeout(() => { mainContainer.style.opacity = '1'; mainContainer.style.transform = 'scale(1)'; }, 50); }, 300); }
        
        async function loadData() {
            try {
                const response = await fetch(`${JSONBIN_URL}/latest`, { headers: { 'X-Master-Key': API_KEY } });
                if (!response.ok) throw new Error(`Gagal mengambil data`);
                const data = await response.json();
                dataEmails = data.record.dataEmails || [];
                deletedItems = data.record.deletedItems || [];
                renderMainView();
                showNotification('Data berhasil dimuat', 'success');
            } catch (error) {
                console.error("Gagal ambil data:", error);
                showNotification('Error mengambil data', 'error');
                dataEmails = [{ id: 1, email: 'john.doe@example.com', whatsapp: '08123456789', date: '2025-09-05', status: 'running new' }];
                deletedItems = [];
                renderMainView();
            }
        }

        function getFilteredData(isAdminView) {
            const searchTerm = (isAdminView ? adminSearchInput.value : mainSearchInput.value).toLowerCase();
            const status = isAdminView ? 'all' : filterStatus.value;
            let filteredData = [...dataEmails];
            if (status !== 'all') { filteredData = filteredData.filter(item => item.status === status); }
            if (searchTerm) { filteredData = filteredData.filter(item => item.email.toLowerCase().includes(searchTerm)); }
            filteredData.sort((a, b) => new Date(b.date) - new Date(a.date));
            return filteredData;
        }

        function renderMainView() {
            const data = getFilteredData(false); cardContainer.innerHTML = '';
            if (!Array.isArray(data) || data.length === 0) { cardContainer.innerHTML = `<p style="text-align: center; grid-column: 1 / -1; padding: 40px; color: var(--text-light);">Tidak ada data</p>`; return; }
            const today = new Date().getDay(); const isWithdrawalActive = today >= 3 && today <= 5;
            data.forEach(item => {
                const card = document.createElement('div'); card.className = 'data-card';
                const lightColorClass = item.status === 'restric' ? 'status-red' : 'status-green';
                const withdrawButtonHTML = isWithdrawalActive ? `<a href="payment.html" class="withdraw-btn"><i class="fas fa-money-bill-wave"></i> Withdraw</a>` : `<button class="withdraw-btn-locked" title="Penarikan hanya tersedia hari Rabu - Jumat"><i class="fas fa-lock"></i> Withdraw</button>`;
                card.innerHTML = `<div class="card-header">${item.email || "(email kosong)"}</div><div class="card-body"><div class="card-date">${formatDate(item.date)}</div><div class="status-light ${lightColorClass}"></div></div><div class="card-footer">${withdrawButtonHTML}</div>`;
                cardContainer.appendChild(card);
            });
        }
        
        function renderAdminView() {
            const data = getFilteredData(true); adminCardContainer.innerHTML = '';
            if (!Array.isArray(data) || data.length === 0) { adminCardContainer.innerHTML = `<p style="text-align: center; grid-column: 1 / -1; padding: 40px; color: var(--text-light);">Tidak ada data yang cocok.</p>`; return; }
            data.forEach(item => {
                const card = document.createElement('div'); card.className = 'data-card admin-card';
                const statusClass = item.status.replace(/\s+/g, '-');
                card.innerHTML = `<div class="card-header">${item.email || "(email kosong)"}</div><div class="card-body"><div class="card-info">WA: <span>${item.whatsapp || '-'}</span>Tanggal: <span>${formatDate(item.date)}</span></div><span class="status ${statusClass}">${item.status}</span></div><div class="card-footer"><div class="action-buttons"><button class="action-btn edit-btn" data-id="${item.id}" title="Edit"><i class="fas fa-edit"></i> Edit</button><button class="action-btn delete-btn" data-id="${item.id}" title="Hapus"><i class="fas fa-trash"></i> Hapus</button></div></div>`;
                adminCardContainer.appendChild(card);
            });
        }

        function startDeleteProcess(id) { pendingDeleteId = id; confirmationModal1.style.display = 'flex'; }
        function handleConfirmation1(e) { const action = e.target.dataset.action; if (action === 'close') { confirmationModal1.style.display = 'none'; } else if (action === 'confirm-1') { confirmationModal1.style.display = 'none'; confirmationModal2.style.display = 'flex'; } }
        function handleConfirmation2(e) { const action = e.target.dataset.action; if (action === 'close') { confirmationModal2.style.display = 'none'; } else if (action === 'confirm-2') { confirmationModal2.style.display = 'none'; if (pendingDeleteId) { deleteItem(pendingDeleteId); pendingDeleteId = null; } } }

        function openIdentificationModal() { document.getElementById('email-list-input').value = ''; document.getElementById('identification-results').style.display = 'none'; identificationModal.style.display = 'flex'; }
        function processEmailList() {
            const emailList = document.getElementById('email-list-input').value.split('\n').map(e => e.trim().toLowerCase()).filter(e => e.length > 0);
            const emailSet = new Set(emailList); identifiedEmailsForUpdate = dataEmails.filter(item => emailSet.has(item.email.toLowerCase()));
            document.getElementById('found-count').textContent = `Ditemukan ${identifiedEmailsForUpdate.length} email`;
            document.getElementById('found-emails-list').innerHTML = identifiedEmailsForUpdate.map(item => `<div>${item.email}</div>`).join('');
            document.getElementById('identification-results').style.display = 'block';
            if (identifiedEmailsForUpdate.length === 0) { showNotification('Tidak ada email yang cocok ditemukan di database.', 'error'); }
        }

        async function bulkUpdateStatus() {
            if (identifiedEmailsForUpdate.length === 0) { showNotification('Tidak ada email untuk diubah.', 'error'); return; }
            const newStatus = document.getElementById('bulk-status-select').value;
            const emailsToUpdate = new Set(identifiedEmailsForUpdate.map(item => item.email.toLowerCase()));
            dataEmails.forEach(item => { if (emailsToUpdate.has(item.email.toLowerCase())) { item.status = newStatus; } });
            await updateRemoteData(`${identifiedEmailsForUpdate.length} email berhasil diubah statusnya.`);
            renderMainView(); renderAdminView(); identificationModal.style.display = 'none';
        }

        function openHistoryModal() {
            const listEl = document.getElementById('deleted-items-list');
            const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);
            const recentDeletions = deletedItems.filter(item => new Date(item.deletedAt) > twentyFourHoursAgo);
            
            listEl.innerHTML = '';
            if (recentDeletions.length === 0) { listEl.innerHTML = '<p>Tidak ada data yang dihapus dalam 24 jam terakhir.</p>'; } 
            else {
                recentDeletions.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'deleted-item';
                    const timeDeleted = new Date(item.deletedAt).toLocaleString('id-ID');
                    itemEl.innerHTML = `<div class="deleted-item-info"><span>${item.email}</span><small>Dihapus pada: ${timeDeleted}</small></div><button class="btn btn-secondary undo-btn" data-id="${item.id}"><i class="fas fa-undo"></i> Undo</button>`;
                    listEl.appendChild(itemEl);
                });
            }
            historyModal.style.display = 'flex';
        }

        async function undoDelete(id) {
            const itemToRestore = deletedItems.find(item => item.id === id);
            if (!itemToRestore) return;
            delete itemToRestore.deletedAt;
            dataEmails.push(itemToRestore);
            deletedItems = deletedItems.filter(item => item.id !== id);
            await updateRemoteData(`Email ${itemToRestore.email} berhasil dipulihkan.`);
            renderMainView();
            renderAdminView();
            openHistoryModal(); // Refresh the modal view
        }

        async function updateRemoteData(successMessage) {
            try {
                const newData = { dataEmails, deletedItems };
                const response = await fetch(JSONBIN_URL, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY }, body: JSON.stringify(newData) });
                if (!response.ok) throw new Error('Gagal menyimpan data ke server');
                if (successMessage) showNotification(successMessage, 'success');
            } catch (error) { console.error('Error menyimpan data:', error); showNotification('Error menyimpan data', 'error'); await loadData(); }
        }
        
        async function saveData(e) {
            e.preventDefault(); const id = document.getElementById('edit-id').value;
            const newData = { email: document.getElementById('email').value.trim(), whatsapp: document.getElementById('whatsapp').value.trim(), date: document.getElementById('date').value, status: document.getElementById('status').value };
            if (!newData.email || !newData.date) { showNotification('Email dan Tanggal tidak boleh kosong', 'error'); return; }
            if (id) { const index = dataEmails.findIndex(item => item.id === parseInt(id)); if (index !== -1) dataEmails[index] = { ...dataEmails[index], ...newData, id: parseInt(id) }; } 
            else { const newId = dataEmails.length > 0 ? Math.max(...dataEmails.map(item => item.id || 0)) + 1 : 1; dataEmails.push({ ...newData, id: newId }); }
            renderMainView(); renderAdminView();
            await updateRemoteData('Data berhasil disimpan'); clearAdminForm();
        }

        async function deleteItem(id) {
            const itemIndex = dataEmails.findIndex(item => item.id === id);
            if (itemIndex === -1) return;
            const [itemToDelete] = dataEmails.splice(itemIndex, 1);
            itemToDelete.deletedAt = new Date().toISOString();
            deletedItems.push(itemToDelete);
            renderMainView(); renderAdminView();
            await updateRemoteData('Data berhasil dihapus dan masuk ke riwayat.');
        }

        function populateEditForm(id) {
             const item = dataEmails.find(d => d.id === id); if (!item) return;
             document.getElementById('form-title').textContent = 'Edit Data';
             document.getElementById('edit-id').value = item.id;
             document.getElementById('email').value = item.email;
             document.getElementById('whatsapp').value = item.whatsapp || '';
             document.getElementById('date').value = item.date;
             document.getElementById('status').value = item.status;
             document.getElementById('save-btn').innerHTML = '<i class="fas fa-save"></i> Update';
             document.getElementById('cancel-edit-btn').style.display = 'inline-block';
             document.querySelector('.form-container').scrollIntoView();
        }
        function clearAdminForm() { document.getElementById('form-title').textContent = 'Tambah Data Baru'; adminForm.reset(); document.getElementById('edit-id').value = ''; document.getElementById('save-btn').innerHTML = '<i class="fas fa-save"></i> Simpan'; document.getElementById('cancel-edit-btn').style.display = 'none'; }
        function showNotification(message, type) { const el = document.getElementById('notification'); el.querySelector('#notification-text').textContent = message; el.className = `notification show ${type}`; setTimeout(() => { el.className = 'notification'; }, 3000); }
        function formatDate(dateString) { if (!dateString) return ''; const date = new Date(dateString); const options = { weekday: 'long', day: '2-digit', month: 'short', year: '2-digit' }; const parts = new Intl.DateTimeFormat('id-ID', options).formatToParts(date); const part = (t) => parts.find(p => p.type === t)?.value || ''; return `(${part('weekday')}, ${part('day')} ${part('month')} '${part('year')})`; }
    </script>
</body>
</html>

